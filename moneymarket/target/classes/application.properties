# Profile Configuration - Force default profile
spring.profiles.active=default

# Database Configuration
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://127.0.0.1:3306/moneymarketdb?createDatabaseIfNotExist=true}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:asif@yasir123}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA Configuration
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.createSchemas=true
spring.flyway.schemas=moneymarketdb
spring.flyway.default-schema=moneymarketdb
spring.jpa.properties.hibernate.default_schema=moneymarketdb

# Server Configuration
server.port=8082

# CORS Configuration (for EC2 deployment, add your frontend URL)
# Example: cors.allowed.origins=http://your-ec2-ip:3000,https://your-domain.com
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:}

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always

# ========================================
# EOD Configuration (End of Day Processing)
# ========================================
# 
# EOD PROCESS OVERVIEW:
# The End of Day (EOD) process is a critical batch operation that runs at the end of each business day
# to finalize all transactions, update balances, accrue interest, generate reports, and advance the system date.
#
# EOD EXECUTION MODES:
# 1. Manual Execution: Via REST API endpoints (recommended for development/testing)
#    - Individual Jobs: POST /api/admin/eod/jobs/execute/{jobNumber}?userId=USER
#    - Job Status: GET /api/admin/eod/jobs/status
#    - Can Execute Check: GET /api/admin/eod/jobs/can-execute/{jobNumber}
# 2. Scheduled Execution: Automatic execution via cron scheduler (production)
#    - Controlled by: eod.scheduler.enabled
#    - Schedule: eod.scheduler.cron
#
# EOD BATCH JOBS (Sequential Execution - Jobs must complete in order):
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 1: Account Balance Update                                               │
# │   - Deletes ALL Entry status transactions (regardless of transaction date)  │
# │   - Aggregates Tran_Table entries into Acct_Bal                            │
# │   - Calculates: Closing Balance = Opening + Credits - Debits               │
# │   - Updates current and available balances for all accounts                 │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/1                           │
# └─────────────────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 2: Interest Accrual Transaction Update                                  │
# │   - Calculates daily interest accrual for all interest-bearing accounts    │
# │   - Creates interest accrual transactions in Tran_Table                    │
# │   - Formula: (Principal × Rate × Days) / Divisor                           │
# │   - Divisor: interest.default.divisor (default: 36500 for 365 days × 100)  │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/2                           │
# └─────────────────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 3: Interest Accrual GL Movement Update                                  │
# │   - Creates GL movements for interest accrual transactions                 │
# │   - Updates GL_Movement table with interest accrual entries                │
# │   - Ensures double-entry bookkeeping for interest accruals                 │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/3                           │
# └─────────────────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 4: GL Movement Update                                                   │
# │   - Processes all non-interest GL movements from Tran_Table                │
# │   - Aggregates GL movements by GL account and date                         │
# │   - Updates GL_Movement table with transaction summaries                   │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/4                           │
# └─────────────────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 5: GL Balance Update                                                    │
# │   - Aggregates GL_Movement entries into GL_Balance                         │
# │   - Calculates closing balances for all GL accounts                        │
# │   - Asset/Expense GLs: Closing = Opening + Debits - Credits                │
# │   - Liability/Equity/Income GLs: Closing = Opening + Credits - Debits      │
# │   - Validates GL balance calculations                                      │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/5                           │
# └─────────────────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 6: Interest Accrual Account Balance Update                              │
# │   - Updates account balances with accrued interest                         │
# │   - Adds accrued interest to account current balance                       │
# │   - Updates interest accrual balance tracking                              │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/6                           │
# └─────────────────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 7: Financial Reports Generation                                         │
# │   - Generates Trial Balance report                                         │
# │   - Generates Balance Sheet report                                         │
# │   - Saves reports to filesystem (reports directory)                        │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/7                           │
# └─────────────────────────────────────────────────────────────────────────────┘
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Job 8: System Date Increment                                                │
# │   - Increments System_Date in Parameter_Table by 1 day                     │
# │   - Updates Last_EOD_Date, Last_EOD_Timestamp, Last_EOD_User              │
# │   - Automatically triggers after Jobs 1-7 complete successfully            │
# │   - Endpoint: POST /api/admin/eod/jobs/execute/8                           │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# SEQUENTIAL EXECUTION RULES:
# - Jobs must be executed in order (1 → 2 → 3 → 4 → 5 → 6 → 7 → 8)
# - Each job checks if the previous job completed successfully
# - If a job fails, subsequent jobs cannot be executed until the failed job is re-run
# - Jobs can be re-executed if they failed (but not if they succeeded for the current system date)
# - Job 8 automatically increments system date only after Jobs 1-7 all complete successfully
#
# VALIDATION & LOGGING:
# - Pre-EOD validations run before Job 1 to ensure system is ready
# - Double-entry validation ensures: Total Debits = Total Credits
# - All job executions are logged in EOD_Log_Table
# - Job statuses: "pending", "running", "completed", "failed"
# - Failed jobs can be retried after fixing the underlying issue
#
# SYSTEM DATE MANAGEMENT:
# - EOD uses System_Date from Parameter_Table (not device date/time)
# - System_Date represents the current business day
# - All EOD processing is based on System_Date
# - System_Date increments only after successful completion of all EOD jobs
#
# CONFIGURATION PARAMETERS:
eod.admin.user=${EOD_ADMIN_USER:ADMIN}
#   - Default user ID for EOD operations when executed by system

eod.scheduler.enabled=${EOD_SCHEDULER_ENABLED:false}
#   - Enable/disable automatic scheduled EOD execution
#   - Set to 'true' for production (automatic daily execution)
#   - Set to 'false' for development/testing (manual execution only)
#   - When enabled, EOD runs automatically at the time specified by eod.scheduler.cron

eod.scheduler.cron=${EOD_SCHEDULER_CRON:0 30 23 * * ?}
#   - Cron expression for scheduled EOD execution
#   - Default: 0 30 23 * * ? = Every day at 11:30 PM
#   - Format: second minute hour day month dayOfWeek
#   - Examples:
#     * 0 30 23 * * ?   = 11:30 PM daily (default)
#     * 0 0 0 * * ?     = Midnight daily
#     * 0 0 22 * * MON-FRI = 10:00 PM weekdays only

system.date=${SYSTEM_DATE:}
#   - Optional: Override system date (leave empty to use Parameter_Table value)
#   - Format: YYYY-MM-DD (e.g., 2024-01-15)
#   - Used for testing/development scenarios

interest.default.divisor=${INTEREST_DEFAULT_DIVISOR:36500}
#   - Default divisor for interest calculations
#   - Formula: (Principal × Rate × Days) / Divisor
#   - Default 36500 = 365 days × 100 (for percentage rates)
#   - Adjust based on your interest calculation requirements

currency.default=${CURRENCY_DEFAULT:BDT}
#   - Default currency code for transactions
#   - Used when currency is not specified

exchange.rate.default=${EXCHANGE_RATE_DEFAULT:1.0}
#   - Default exchange rate (for single-currency systems)
#   - Set to 1.0 for single currency operations

# ========================================
# BOD Configuration (Beginning of Day - Value Dating)
# ========================================
# PTTP05: Value Date Transactions

# Enable/disable automatic BOD execution
# Set to 'true' for production (automatic daily execution)
# Set to 'false' for development/testing (manual only)
bod.scheduler.enabled=${BOD_SCHEDULER_ENABLED:false}

# Cron expression for BOD execution
# Default: 0 0 6 * * ? = Every day at 6:00 AM
# Format: second minute hour day month dayOfWeek
# Examples:
#   0 0 6 * * ?   = 6:00 AM daily (default)
#   0 30 5 * * ?  = 5:30 AM daily
#   0 0 7 * * MON-FRI = 7:00 AM weekdays only
bod.scheduler.cron=${BOD_SCHEDULER_CRON:0 0 6 * * ?}

# Enable Spring scheduling support
spring.task.scheduling.enabled=true

# Thread pool size for scheduled tasks
spring.task.scheduling.pool.size=2

# Manual BOD endpoint: POST /api/bod/run (always available)
# Status endpoint: GET /api/bod/status

# Logging Configuration
logging.level.root=INFO
logging.level.com.example.moneymarket=DEBUG
logging.level.com.example.moneymarket.service.SubProductService=DEBUG
logging.level.com.example.moneymarket.controller.SubProductController=DEBUG
logging.level.com.example.moneymarket.service.EODService=INFO
logging.level.com.example.moneymarket.service.AccountBalanceUpdateService=INFO
logging.level.com.example.moneymarket.service.InterestAccrualService=INFO
logging.level.com.example.moneymarket.service.GLBalanceUpdateService=DEBUG
logging.level.com.example.moneymarket.scheduler.BODScheduler=INFO
logging.level.com.example.moneymarket.service.BODValueDateService=INFO
logging.level.com.example.moneymarket.service.ValueDateValidationService=DEBUG
logging.level.com.example.moneymarket.service.ValueDateCalculationService=DEBUG
logging.level.com.example.moneymarket.service.ValueDatePostingService=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} [%X{correlationId}] - %msg%n

# ========================================
# Settlement Alert Configuration
# ========================================
# Enable/disable settlement alerts
settlement.alert.enabled=true

# Threshold for settlement GAIN alerts (in BDT)
# Alerts will be generated when gain exceeds this amount
settlement.alert.gain.threshold=50000

# Threshold for settlement LOSS alerts (in BDT)
# Alerts will be generated when loss exceeds this amount
settlement.alert.loss.threshold=50000
